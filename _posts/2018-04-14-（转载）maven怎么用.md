---
layout:     post
title:      "（转载）maven怎么用"
subtitle:   ""
date:       2018-04-14
author:     "漆黑菌"
header-img: "img/post-bg.jpg"
catalog: true
tags:
    - maven
    - myeclipse
---

# 一、Maven常用命令

在学习使用Maven构建项目之前，先来了解一下Maven一些实用的命令。<span style="font-size: 14pt;">mvn</span>的命令有很多，在项目开发中，理解了下面的几个常用命令后，运用maven就基本没有问题了。Maven常用的命令如下：

## 1.1 常用的mvn命令

<span style="color: #c00000;"><span style="font-family: Courier New; font-size: 16pt;">**mvn <span style="color: blue;">archetype:create</span> **</span><span style="color: #ff0066;">**创建** <span style="color: red;"><span style="color: #006600;">**Maven 项目**<span style="font-family: 宋体;">
</span><span style="color: #c00000;"><span style="font-family: Courier New; font-size: 16pt;">**mvn <span style="color: blue;">compile</span> **</span><span style="color: #ff0066;">**编译<span style="color: #006600;">主程序</span>**源代码<span style="color: #c00000;">，<span style="color: #ff0066;">**不会编译<span style="color: #006600;">test目录的源代码</span>**。第一次运行时，会下载相关的依赖包，可能会比较费时</span><span style="font-family: 宋体;">
</span><span style="font-family: Courier New; font-size: 16pt;">**mvn <span style="color: blue;">test-compile</span> **</span><span style="color: #ff0066;">**编译<span style="color: #006600;">测试代码</span>**<span style="color: #c00000;">，</span>compile</span>之后会生成<span style="color: blue;">target文件夹</span>，<span style="color: #ff0066;">**主程序**</span>编译在<span style="color: blue;">classes</span>下面，<span style="color: #ff0066;">**测试程序**</span>放在<span style="color: blue;">test-classes</span>下</span><span style="font-family: 宋体;">
</span><span style="color: #c00000;">**<span style="font-family: Courier New; font-size: 16pt;">mvn <span style="color: blue;">test</span> </span><span style="color: #ff0066;">运行</span>**应用程序中的单元测试</span></span><span style="font-family: 宋体;">
</span>**<span style="font-family: Courier New; font-size: 16pt;">mvn <span style="color: blue;">site</span> </span><span style="color: #ff0066;">生成</span>**项目相关信息的网站</span></span><span style="font-family: 宋体;">
</span><span style="color: #c00000;">**<span style="font-family: Courier New; font-size: 16pt;">mvn <span style="color: blue;">clean</span> </span><span style="color: #ff0066;">清除</span>**目标目录中的生成结果</span></span><span style="font-family: 宋体;">
</span><span style="color: #c00000;">**<span style="font-family: Courier New; font-size: 16pt;">mvn <span style="color: blue;">package</span> </span><span style="color: #ff0066;">依据项目</span>**生成 <span style="color: red;">jar 文件</span>，打包之前会进行编译，测试</span><span style="font-family: 宋体;">
</span><span style="color: #c00000;">**<span style="font-family: Courier New; font-size: 16pt;">mvn <span style="color: blue;">install</span></span><span style="color: #ff0066;">在本地</span>** Repository</span> 中<span style="color: red;">安装 jar</span><span style="font-family: 宋体;">。</span></span></span><span style="font-family: 宋体;">
</span><span style="color: #c00000;"><span style="font-family: Courier New; font-size: 16pt;">**mvn <span style="color: blue;">eclipse:eclipse</span> **</span><span style="color: #ff0066;">**生成** <span style="color: red;"><span style="color: #006600;">**Eclipse 项目文件**</span>及<span style="color: #006600;">**包引用定义**</span><span style="font-family: 宋体;">
</span><span style="color: #c00000;"><span style="font-family: Courier New; font-size: 16pt;">**mvn <span style="color: blue;">deploy</span> **</span>在<span style="color: #ff0066;">**整合**</span>或者<span style="color: #ff0066;">**发布**</span>环境下执行，将最终版本的包拷贝到远程</span></span> 的</span>repository</span>，使得其他的开发者或者工程可以共享。

## <span style="font-family: 微软雅黑;">1.2</span> 一些高级功能命令

<span style="color: #0070c0;">跳过测试类 ：</span> -<span style="color: blue;">Dmaven.test.skip</span>=true

<span style="color: #0070c0;">下载jar包源码：</span> -<span style="color: blue;">DdownloadSource</span>=true

<span style="color: #0070c0;">下载javadocs：</span> -<span style="color: blue;">DdownloadJavadocs</span>=true

例如：

> mvn package -Dmaven.test.skip=true ：表示打包时忽略掉test目录，不编译。
> mvn install -DdownloadSource=true ：本地安装jar包时，下载jar的源文件包。

# 二、Maven简单使用

到目前为止，我们已经大概了解并安装好了Maven。为了进一步学习Maven，我们和其他项目同样以一个最简单的HelloWorld项目开始，探究Maven的核心概念。通过对该项目的学习，来让我们对<span style="color: #ff0066;">构建生命周期</span> (Build Life Cycle)，<span style="color: #ff0066;">Maven仓库</span> (Repositories)，<span style="color: #ff0066;">依赖管理</span> (Dependency Management)和<span style="color: #ff0066;">项目对象模型</span> (Project Object Model)有一个基本的理解。

## 2.1 编写POM

就像<span style="color: #ff0066;">Make</span>的<span style="color: blue;">Makefile</span>、<span style="color: #ff0066;">Ant</span>的<span style="color: blue;">build.xml</span>一样，Maven项目的核心是pom.xml。POM(Project Object Model)，<span style="color: #ff0066;">项目对象模型</span>定义了<span style="color: blue;">项目的基本信息</span>，用于<span style="color: #ff0066;">描述项目<span style="color: blue;">如何构建</span>，声明项目<span style="color: blue;">依赖</span>，等等。现在先为</span>HelloWorld项目编写一个最简单的pom. xml，

首先创建一个名为helloworld的文件夹，打开该文件夹，新建一个名为pom.xml的文件，输入其内容，如代码清单如下所示：

> <span style="font-family: Calibri;"><?xml version="1.0" encoding="UTF-8"?></span>
> 
> <span style="font-family: Calibri;"><project <span style="color: red;">xmlns</span>="http://maven.apache.org/POM/4.0.0"</span>
> 
> <span style="font-family: Calibri;"><span style="color: red;">xmlns</span>:<span style="color: #006600;">xsi</span>="http://www.w3.org/2001/XMLSchema-instance"</span>
> 
> <span style="font-family: Calibri;"><span style="color: #006600;">xsi</span>:<span style="color: #00b0f0;">schemaLocation</span>="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"></span>
> 
> <span style="font-family: Calibri;">    <<span style="color: #ff0066;">modelVersion</span>><span style="color: blue;">4.0.0</span><<span style="color: #ff0066;">/modelVersion</span>></span>
> 
> <span style="font-family: Calibri;">    <<span style="color: #ff0066;">groupId</span>><span style="color: blue;">org.hebut.test</span><<span style="color: #ff0066;">/groupId</span>></span>
> 
> <span style="font-family: Calibri;">    <<span style="color: #ff0066;">artifactId><span style="color: blue;">helloworld</span></artifactId</span>></span>
> 
> <span style="font-family: Calibri;">    <<span style="color: #ff0066;">version><span style="color: blue;">0.0.1-SNAPSHOT</span></version</span>></span>
> 
> <span style="font-family: Calibri;">    <<span style="color: #ff0066;">name</span>><span style="color: blue;">Maven Hello World Project</span><<span style="color: #ff0066;">/name</span>></span>
> 
> <span style="font-family: Calibri;"></project></span>

<span style="color: #0070c0;">**XML头**</span>

代码的第一行是XML头，指定了该<span style="color: blue;">xml文档的版本</span>和<span style="color: blue;">编码方式</span>。

<span style="color: #0070c0;">**project元素**</span>

XML头之后紧接着就是<span style="color: red;">project元素</span>，project是所有pom.xml的根元素，它还声明了一些POM相关的<span style="color: blue;">命名空间</span>及<span style="color: blue;">xsd元素</span>，虽然这些属性不是必须的，但使用这些属性能够让第三方工具（如IDE中的XMl编辑器）帮助我们快速编辑POM 。

<span style="color: #0070c0;">**modelVersion元素**</span>

根元素下的第一个子元素<span style="color: red;">modelVersion</span>，它指定了当前<span style="color: blue;">POM模型的版本</span>，对于Maven 3以及Maven 3来说，它只能是4.0.0。

<span style="color: #0070c0;">**坐标**</span>

这段代码中最重要的是：包含<span style="color: blue;">groupId</span>、<span style="color: blue;">artifactId</span>和<span style="color: blue;">version</span>的三行。这三个元素定义了一个<span style="color: #ff0066;">项目基本的坐标</span>，在Maven的世界，任何的jar、pom或者war都是以基于这些基本的坐标进行区分的。

<span style="color: #0070c0;">**groupId元素**</span>

<span style="color: red;">groupId</span>定义了<span style="color: blue;">项目属于哪个组</span>，这个组往往和项目所在的<span style="color: blue;">组织</span>或<span style="color: blue;">公司存在关联</span>。譬如在googlecode上建立了一个名为myapp的项目，那么groupId就应该是com.googlecod.myapp，如果你的公司是mycom，有一个项目为myapp。耶么groupId就应该是com.mycom.myapp。

<span style="color: #0070c0;">**artifactId元素**</span>

<span style="color: red;">artifactId</span>定义了<span style="color: #006600;">当前Maven项目<span style="color: #ff0066;">在组中<span style="color: blue;">唯一的ID</span>，</span>我们为这个</span>HelloWord项目定义<span style="color: #ff0066;">artifactId</span>为<span style="color: blue;">hello-world</span>。在前面的groupld为

com.googlecode.myapp的例子中，你可能会为<span style="color: blue;">不同的子项目</span>（模块）分配artifactId，如myapp-util、myapp-domain、myapp-web等。

<span style="color: #0070c0;">**version元素**</span>

顾名思义，<span style="color: red;">version</span>指定了Hello World项目<span style="color: blue;">当前的版本</span>0.0.1。<span style="color: #ff0066;">SNAPSHOT</span>意为快照，说明该<span style="color: blue;">项目还处于开发中</span>，是不稳定的版本。随着项目的展，version会不断更新，如升级为0.0.2、0.0.3、1.0.0等。

<span style="color: #0070c0;">**name元素**</span>

最后一个<span style="color: red;">name元素，</span>声明了一个对于用户更为友好的<span style="color: blue;">项目名称</span>，虽然这不是必须的，但还是推荐为每个POM声明name。以方便信息交流。

没有任何实际的Java代码，我们就能够定义一个Maven项目的POM，这体现了Maven的一大优点，它能让<span style="color: blue;">项目对象模型<span style="color: #ff0066;">最大程度地</span>与实际代码<span style="color: #ff0066;">相独立</span>，我们可以称之为<span style="color: #ff0066;">解耦</span>，或者<span style="color: #ff0066;">正交性</span>。</span>这在很大程度上<span style="color: #ff0066;">避免了<span style="color: blue;">Java代码</span>和<span style="color: blue;">POM代码<span style="color: #ff0066;">的相互影响</span>：比如当项目需要升</span>级版本时，只需要修改</span>POM。而不需要更改Java代码；而在POM稳定之后，日常的Java代码开发工作基本不涉及POM的修改。

## 2.2 编写主代码

项目<span style="color: blue;">主代码</span>和<span style="color: blue;">测试代码<span style="color: red;">不同</span>，项目的<span style="color: #ff0066;">主代码</span>会被<span style="color: #006600;">打包到<span style="color: blue;">最终的构件中</span>如</span>：</span>jar。而<span style="color: #ff0066;">测试代码</span>只在<span style="color: blue;">运行测试时用到</span>，不会被打包。默认情况下，Maven假设项目主代码位于<span style="color: #00b0f0;">src/main/java</span>目录，我们遵循Maven的约定，创建该目录，然后在该目录下创建文件org/hebut/test/helloworld/HelloWorld. java，其内容如代码如下所示：

> <span style="color: #7f0055; font-family: Courier New; font-size: 14pt;">**package** <span style="color: black;">org.hebut.test.helloworld</span></span>
> 
> <span style="color: #7f0055; font-family: Courier New; font-size: 14pt;">**public** <span style="color: black;"><span style="color: #7f0055;">**class** <span style="color: black;">HelloWorld{</span></span></span></span>
> 
> <span style="color: black; font-family: Courier New; font-size: 14pt;">    <span style="color: #7f0055;">**public** <span style="color: black;">String sayHello(){</span></span></span>
> 
> <span style="color: black; font-family: Courier New; font-size: 14pt;">        <span style="color: #7f0055;">**return** <span style="color: black;"><span style="color: #2a00ff;">"Hello Maven"<span style="color: black;">;</span></span></span></span></span>
> 
> <span style="font-family: Courier New; font-size: 14pt;"><span style="color: black;">    }</span></span>
> 
> <span style="color: black; font-family: Courier New; font-size: 14pt;">    <span style="color: #7f0055;">**public** <span style="color: black;"><span style="color: #7f0055;">**static** <span style="color: black;"><span style="color: #7f0055;">**void** <span style="color: black;">main(String[] args){</span></span></span></span></span></span></span>
> 
> <span style="color: black; font-family: Courier New; font-size: 14pt;">        System.<span style="color: #0000c0;">_out_<span style="color: black;">.println(<span style="color: #7f0055;">**new** <span style="color: black;">HelloWorld());</span></span></span></span></span>
> 
> <span style="font-family: Courier New; font-size: 14pt;"><span style="color: black;">    }</span></span>
> 
> <span style="color: black; font-family: Courier New; font-size: 14pt;">}</span>

这是一个简单的Java类，它有一个sayHello()方法，返回一个String同时这个类还带有一个main方法，创建一个HelloWorld实例，调用sayHello()方法，并将结果输出到控制台。

关于该Java代码有两点需要注意：<span style="color: #c00000;">首先</span>，在绝大多数情况下，应该把项目主代码放到<span style="color: #ff0066;">src/main/java/</span>目录下，而无须额外的配置，Maven会自动搜寻该目录找到项目主代码。<span style="color: #c00000;">其次</span>，该Java类的包名是org.hebut.test.helloworld，这与之前在POM中定义的groupId和artifactld相吻合。一般来说，项目中Java类的包都应该基于项目的groupld和anifactId。这样更加清晰，更加符合逻辑，也方便搜索构件或者Java类。

代码编写完毕后，使用Maven进行编译，在项目的根目录下运行命令<span style="color: blue;">mvn clean compile</span>会得到如下输出：

![](https://images0.cnblogs.com/blog/671563/201503/161247398292378.png)

执行完毕，发现项目根目录多了一个target目录：

![](https://images0.cnblogs.com/blog/671563/201503/161247406102250.png)

上面使用的<span style="color: blue;">clean命令</span>告诉Maven<span style="color: #ff0066;">清理输出目录target/</span>，<span style="color: blue;">compile</span>告诉Maven<span style="color: #ff0066;">编译项目主代码</span>，从输出中看到Maven<span style="color: #006600;">**首先**</span>执行了<span style="color: blue;">clean：clean任务</span>，删除target/目录。默认情况下，Maven构建的所有输出都在<span style="color: #ff0066;">target/目录</span>中；<span style="color: #006600;">**接着**</span>执行<span style="color: blue;">resources：resources任务</span>，未定义项目资源，暂且略过；

<span style="color: #006600;">**最后**</span>执行<span style="color: blue;">compiler：compile任务</span>，将项目主代码编译至<span style="color: #ff0066;">target/classes</span>目录，编译好的类为：

org/hebut/test/helloworld/HelloWorld.Class

上文提到的<span style="color: blue;">clean:clean</span>、<span style="color: blue;">resources:resources</span>和<span style="color: blue;">compiler:compile</span>对应了一些<span style="color: red;">Maven插件</span>及<span style="color: red;">插件目标</span>，比如<span style="color: #006600;">clean:clean</span>是<span style="color: #ff0066;">clean插件</span>的<span style="color: blue;">clean目标</span>，<span style="color: #006600;">compiler:compile</span>是<span style="color: #ff0066;">compiler插件</span>的<span style="color: blue;">compile目</span>。

至此，Maven在没有任何额外的配置的情况下就执行了项目的清理和编译任务。接下来，编写一些单元测试代码并让Maven执行自动化测试。

## 2.3 编写测试代码

为了使项目结构保持清晰，主代码与测试代码应陔分别位于独立的目录中。正如上面所述，Maven项目中<span style="color: #ff0066;">默认的主代码目录</span>是<span style="color: blue;">src/main/java</span>。对应地，Maven项目中<span style="color: #ff0066;">默认的测试代码目录</span>是<span style="color: blue;">src/test/java</span>。因此，在编写测试用例之前，应当先创建该目录。

### 2.3.1 设置依赖

在Java世界中，由Kent Beck和Erich Gamma建立的JUnit是事实上的单元测试标准。要使用JUnit，首先需要为HelloWorld项目添加一个JUnit依赖，修改项目的POM代码如下：

> <span style="font-family: Calibri;"><?xml version="1.0" encoding="UTF-8"?></span>
> 
> <span style="font-family: Calibri;"><project <span style="color: red;">xmlns</span>="http://maven.apache.org/POM/4.0.0"</span>
> 
> <span style="font-family: Calibri;"><span style="color: red;">xmlns</span>:<span style="color: #006600;">xsi</span>="http://www.w3.org/2001/XMLSchema-instance"</span>
> 
> <span style="font-family: Calibri;"><span style="color: #006600;">xsi</span>:<span style="color: #00b0f0;">schemaLocation</span>="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"></span>
> 
> <span style="font-family: Calibri;">    <<span style="color: #ff0066;">modelVersion</span>><span style="color: blue;">4.0.0</span><<span style="color: #ff0066;">/modelVersion</span>></span>
> 
> <span style="font-family: Calibri;">    <<span style="color: #ff0066;">groupId</span>><span style="color: blue;">org.hebut.test</span><<span style="color: #ff0066;">/groupId</span>></span>
> 
> <span style="font-family: Calibri;">    <<span style="color: #ff0066;">artifactId><span style="color: blue;">helloworld</span></artifactId</span>></span>
> 
> <span style="font-family: Calibri;">    <<span style="color: #ff0066;">version><span style="color: blue;">0.0.1-SNAPSHOT</span></version</span>></span>
> 
> <span style="font-family: Calibri;"><<span style="color: #ff0066;">name</span>><span style="color: blue;">Maven Hello World Project</span><<span style="color: #ff0066;">/name</span>></span>
> 
> <span style="font-family: Calibri;"><<span style="color: #ff0066;">dependencies</span>></span>
> 
> <span style="font-family: Calibri;"><<span style="color: #006600;">dependency</span>></span>
> 
> <span style="font-family: Calibri;"><groupId>junit</groupId></span>
> 
> <span style="font-family: Calibri;"><artifactId>junit</artifactId></span>
> 
> <span style="font-family: Calibri;"><version>4.7</version></span>
> 
> <span style="font-family: Calibri;"><scope>test</scope></span>
> 
> <span style="font-family: Calibri;"></<span style="color: #006600;">dependency</span>></span>
> 
> <span style="font-family: Calibri;">    </<span style="color: #ff0066;">dependencies</span>></span>
> 
> <span style="font-family: Calibri;"></project></span>

<span style="color: #0070c0;">**dependencies元素**</span>

代码中添加了<span style="color: #ff0066;">dependencies元素</span>，该元素下可以包含多个dependency元素以<span style="color: blue;">声明项目的依赖</span>。

<span style="color: #0070c0;">**dependency元素**</span>

dependency元素用以<span style="color: blue;">声明项目的依赖</span>，这里添加了一个依赖groupId是junit，artifactld是junit，version是4.7。前面提到groupId、artifactId和versIon是任何一个Maven项目最基本的坐标。JUnit也不例外，有了这段声明Maven就能够自动下载junit-4.7.jar。那么，Maven从哪里下载这个jar 呢?

在使用Maven之前，可以去JUnit的官方网站下载分发包。有了Maven之后，它会自动访问中央仓库：

[http://repo1.maven.org/maven2/](http://repo1.maven.org/maven2/),下载需要的文件。

当然与可以自己访问该仓库，打开路径junit/junit/4\. 7/，就能看到junit-4.7.pom和junit-4.7.jar。

![](https://images0.cnblogs.com/blog/671563/201503/161247415325164.png)

<span style="color: #0070c0;">**scope元素**</span>

上述POM代码中还有一个值为test的元素scope，scope为<span style="color: blue;">依赖范围</span>，若依赖范围为<span style="color: #ff0066;">test</span>则表示该<span style="color: blue;">依赖只对测试有效</span>。换句话说，<span style="color: red;">测试代码中</span>的import JUnit代码是没有问题的，但是如果在<span style="color: red;">主代码中</span>用import Junit代码，就会造成编译错误。如果<span style="color: red;">不声明依赖范围</span>，那么<span style="color: blue;">默认值就是compile</span>，表示该依赖对<span style="color: blue;">主代码</span>和<span style="color: blue;">测试代码<span style="color: #ff0066;">都有效</span>。</span>

### 2.3.2 编写测试代码

配置了测试依赖，接着就可以编写测试类。回顾一下前面的HelloWorld类，现在要测试该类的sayHello()方法，检查其返同值是否为"Hello Maven"。在src/test/java目录下创建文件，其内容代码如下所示：

> <span style="color: #7f0055; font-family: Courier New; font-size: 14pt;">**package** <span style="color: black;">org.hebut.test.helloworld;</span></span>
> 
> <span style="color: #7f0055; font-family: Courier New; font-size: 14pt;">**import** <span style="color: black;">org.junit.Test;</span></span>
> 
> <span style="color: #7f0055; font-family: Courier New; font-size: 14pt;">**import** <span style="color: black;"><span style="color: #7f0055;">**static** <span style="color: black;">org.junit.Assert.assertEquals;</span></span></span></span>
> 
> <span style="color: #7f0055; font-family: Courier New; font-size: 14pt;">**public** <span style="color: black;"><span style="color: #7f0055;">**class** <span style="color: black;">HelloWorldTest{</span></span></span></span>
> 
> <span style="color: black; font-family: Courier New; font-size: 14pt;">    <span style="color: #646464;">@<span style="color: black;">Test</span></span></span>
> 
> <span style="color: black; font-family: Courier New; font-size: 14pt;">    <span style="color: #7f0055;">**public** <span style="color: black;"><span style="color: #7f0055;">**void** <span style="color: black;">testSayHello(){</span></span></span></span></span>
> 
> <span style="color: black; font-family: Courier New; font-size: 14pt;">        HelloWorld helloworld=<span style="color: #7f0055;">**new** <span style="color: black;">HelloWorld();</span></span></span>
> 
> <span style="font-family: Courier New; font-size: 14pt;"><span style="color: black;">        String result=helloworld.sayHello();</span></span>
> 
> <span style="color: black; font-family: Courier New; font-size: 14pt;">        assertEquals(<span style="color: #2a00ff;">"Hello Maven"<span style="color: black;">,result);</span></span></span>
> 
> <span style="font-family: Courier New; font-size: 14pt;"><span style="color: black;">    }</span></span>
> 
> <span style="color: black; font-family: Courier New; font-size: 14pt;">}</span>

一个典型的单元测试包含三个步骤：

<span style="font-size: 16pt;">**①**</span> 准备测试类及数据；

**<span style="font-size: 16pt;">②</span>**执行要测试的行为；

<span style="font-size: 16pt;">**③** </span>检查结果。

上述样例，<span style="color: #006600;">**首先**</span>初始化了一个要测试的<span style="color: blue;">HelloWorld实例</span>，<span style="color: #006600;">**接着**</span>执行该实例的<span style="color: blue;">sayHello()方法</span>并保存结果到result变量中，<span style="color: #006600;">**最后**</span>使用JUnit框架的Assert类检查结果是否为我们期望的"Hello Maven"。在JUnit 3中，约定所有需要执行测试的方法都以test开头，这里使用了JUnit 4，但仍然遵循这一约定。在JUnit 4中，需要执行的测试方法都应该以<span style="color: #ff0066;">@Test</span>进行标注。

测试用例编写完毕之后就可以调用Maven执行测试。运行<span style="color: blue;">mvn clean test</span>：

![](https://images0.cnblogs.com/blog/671563/201503/161247421105508.png)

我们看到<span style="color: #c00000;">compiler: testCompile</span>任务执行成功了，测试代码通过编译之后在<span style="color: blue;">target/test-classes</span>下生成了二进制文件:

![](https://images0.cnblogs.com/blog/671563/201503/161247427042623.png)

紧接着<span style="color: #c00000;">surefire：test</span>任务运行测试，<span style="color: #c00000;">surefire</span>是Maven中负责<span style="color: blue;">执行测试的插件</span>，这里它运行测试用例HelloWorldTest，并且输出测试报告，显示一共运行了多少测试，失败了多少，出错了多少，跳过了多少二硅然，我们的测试通过了。

## 2.4 打包安装

将项目进行<span style="color: blue;">编译</span>、<span style="color: blue;">测试</span>之后，下一个重要步骤就是<span style="color: blue;">打包</span>:package。 Hello WorldPOM中没有指定打包类型，使用<span style="color: #ff0066;">默认打包类型jar</span>。简单地执行命令：

<span style="color: blue;">mvn clean package</span>进行打包，可以看到如下输出：

![](https://images0.cnblogs.com/blog/671563/201503/161247432202181.png)

类似地，Maven会在<span style="color: #ff0066;">打包之前</span>执行<span style="color: blue;">编译</span>、<span style="color: blue;">测试</span>等操作，这里看到<span style="color: #c00000;">jar: jar任务</span>负责打包，实际上就是<span style="color: #c00000;">jar插件</span>的<span style="color: blue;">jar目标<span style="color: #006600;">将项目主代码</span>打包成一个名为helloworld-0.0.1-SNAPSHOT.jar</span>的文件。该文件也位于<span style="color: blue;">target/输出目录中</span>，它是根据<span style="color: blue;">artifact-version. jar</span>规则进行命名的，如有需要，还可以使用<span style="color: red;">finalNam</span>e来自定义该文件的名称。

至此，我们得到了项目的输出，如果有需要的话，就可以<span style="color: red;">复制</span>这个jar文件到<span style="color: blue;">其他项目的Classpath中</span>从而使用HelloVV orld类。但是，如何才能让其他的Maven项目直接引用这个jar呢？还需要一个<span style="color: #ff0066;">安装的步骤</span>，执行mvn clean install:

![](https://images0.cnblogs.com/blog/671563/201503/161247437982525.png)

在打包之后，又执行了安装任务<span style="color: blue;">install:install</span>。从输出可以看到该任务将项<span style="color: blue;">目输出的jar</span>安装到了<span style="color: blue;">Maven本地仓库</span>中，可以打开相应的文件夹看到HelloWorld项目的pom和jar:

![](https://images0.cnblogs.com/blog/671563/201503/161247446266411.png)

之前讲述，JUnit的POM及jar的下载的时候，我们说只有构件被下载到本地仓库后，才能由所有Maven项目使用，这里是同样的道理，只有将HelloWorld的构件安装到本地仓库之后，其他Maven项目才能使用它。

我们已经体验了Maven最主要的命令：mvn clean compile、mvn clean test、mvn clean package、mvn clean install。执行test之前是会先执行Compile的，执行package之前是会先执行test的。而类似地，install之前会执行package。可以在任何一个Maven项目中执行这些命令，而且我们已经清楚它们是用来做什么的。

## 2.4 运行

到目前为止，还没有运行Hello World项目，不要忘了HelloWorld类可是有一个main方法的。默认打包生成的jar是不能够直接运行的，因为带有main方法的类信息不会添加到manifest中，即打开jar文件中的META-INF/MANIFEST. MF文件，将无法看到Main-Class一行。<span style="color: #ff0066;">默认Maven生成</span>的JAR包只包含了<span style="color: blue;">编译生成的.class文件</span>和<span style="color: blue;">项目资源文件</span>，而要得到一个可以<span style="color: blue;">直接在命令行通过java命令运行的JAR文件</span>，还要满足两个条件

■ JAR包中的/META-INF/MANIFEST.MF元数据文件必须包含Main-Class信息。

■ 项目所有的依赖都必须在Classpath中。

Maven有好几个插件能帮助用户完成上述任务，不过用起来最方便的还是<span style="color: #ff0066;">maven-shade-plugin</span>， 它可以让<span style="color: blue;">用户配置Main-Class的值</span>，然后在打包的时候将值填入<span style="color: red;">/META-INF/MANIFEST.MF</span>文件。关于<span style="color: red;">项目的依赖</span>，它很聪明地将<span style="color: blue;">依赖JAR文件全部解压后</span>，再将<span style="color: blue;">得到的.class文件<span style="color: #ff0066;">连同<span style="color: blue;">当前项目的.class文件一起合并到最终的<span style="color: #006600;">CLI包中</span>，这样，在执行</span>CLI JAR</span>文件的时候，所有需要的类就都在</span>Classpath中了。下面是一个配置样例：

1.  <div style="background: #f4f4f4;"><span style="color: blue;"><<span style="color: maroon;">build<span style="color: blue;">></span></span></span></div>

2.  <div style="background: #f4f4f4;">   <span style="color: blue;"><<span style="color: maroon;">plugins<span style="color: blue;">></span></span></span></div>

3.  <div style="background: #f4f4f4;">      <span style="color: blue;"><<span style="color: maroon;">plugin<span style="color: blue;">></span></span></span></div>

4.  <div style="background: #f4f4f4;">          <span style="color: blue;"><<span style="color: maroon;">groupId<span style="color: blue;">></span>org.apache.maven.plugins<span style="color: blue;"></<span style="color: maroon;">groupId<span style="color: blue;">></span></span></span></span></span></div>

5.  <div style="background: #f4f4f4;">          <span style="color: blue;"><<span style="color: maroon;">artifactId<span style="color: blue;">></span>maven-shade-plugin<span style="color: blue;"></<span style="color: maroon;">artifactId<span style="color: blue;">></span></span></span></span></span></div>

6.  <div style="background: #f4f4f4;">          <span style="color: blue;"><<span style="color: maroon;">version<span style="color: blue;">></span>1.4<span style="color: blue;"></<span style="color: maroon;">version<span style="color: blue;">></span></span></span></span></span></div>

7.  <div style="background: #f4f4f4;">          <span style="color: blue;"><<span style="color: maroon;">executions<span style="color: blue;">></span></span></span></div>

8.  <div style="background: #f4f4f4;">            <span style="color: blue;"><<span style="color: maroon;">execution<span style="color: blue;">></span></span></span></div>

9.  <div style="background: #f4f4f4;">              <span style="color: blue;"><<span style="color: maroon;">phase<span style="color: blue;">></span>package<span style="color: blue;"></<span style="color: maroon;">phase<span style="color: blue;">></span></span></span></span></span></div>

10.  <div style="background: #f4f4f4;">              <span style="color: blue;"><<span style="color: maroon;">goals<span style="color: blue;">></span></span></span></div>

11.  <div style="background: #f4f4f4;">                <span style="color: blue;"><<span style="color: maroon;">goal<span style="color: blue;">></span>shade<span style="color: blue;"></<span style="color: maroon;">goal<span style="color: blue;">></span></span></span></span></span></div>

12.  <div style="background: #f4f4f4;">              <span style="color: blue;"></<span style="color: maroon;">goals<span style="color: blue;">></span></span></span></div>

13.  <div style="background: #f4f4f4;">              <span style="color: blue;"><<span style="color: maroon;">configuration<span style="color: blue;">></span></span></span></div>

14.  <div style="background: #f4f4f4;">                <span style="color: blue;"><<span style="color: maroon;">transformers<span style="color: blue;">></span></span></span></div>

15.  <div style="background: #f4f4f4;">                  <span style="color: blue;"><<span style="color: maroon;">transformer</span> <span style="color: red;">implementation</span>="org.apache.maven.plugins.shade.resource.ManifestResourceTransformer"></span></div>

16.  <div style="background: #f4f4f4;">                    <span style="color: blue;"><<span style="color: maroon;">mainClass<span style="color: blue;">></span>org.hebut.test.helloworld.HelloWorld<span style="color: blue;"></<span style="color: maroon;">mainClass<span style="color: blue;">></span></span></span></span></span></div>

17.  <div style="background: #f4f4f4;">                  <span style="color: blue;"></<span style="color: maroon;">transformer<span style="color: blue;">></span></span></span></div>

18.  <div style="background: #f4f4f4;">                <span style="color: blue;"></<span style="color: maroon;">transformers<span style="color: blue;">></span></span></span></div>

19.  <div style="background: #f4f4f4;">              <span style="color: blue;"></<span style="color: maroon;">configuration<span style="color: blue;">></span></span></span></div>

20.  <div style="background: #f4f4f4;">            <span style="color: blue;"></<span style="color: maroon;">execution<span style="color: blue;">></span></span></span></div>

21.  <div style="background: #f4f4f4;">          <span style="color: blue;"></<span style="color: maroon;">executions<span style="color: blue;">></span></span></span></div>

22.  <div style="background: #f4f4f4;">      <span style="color: blue;"></<span style="color: maroon;">plugin<span style="color: blue;">></span></span></span></div>

23.  <div style="background: #f4f4f4;">   <span style="color: blue;"></<span style="color: maroon;">plugins<span style="color: blue;">></span></span></span></div>

24.  <div style="background: #f4f4f4;">  <span style="color: blue;"></<span style="color: maroon;">build<span style="color: blue;">></span></span></span></div>

plugin元素在POM中的相对位置应该在<span style="color: #ff0066;"><project><build><plugins></span>下面。我们配置了mainClass为<span style="color: blue;">org.hebut.helloworld.HelloWorld</span>，项目在打包时会将该信息放到MANIFEST中。现在执行<span style="color: blue;">mvn clean install</span>。待构建完成之后打开target/目录，可以看到helloworld-0.0.1-SNAPSHOT.jar和original-helloworld-0.0.1-SNAPSHOT.jar。<span style="color: #ff0066;">前者</span>是<span style="color: blue;">带有Main-Class信息</span>的<span style="color: #006600;">可运行jar</span>，<span style="color: #ff0066;">后者</span>是<span style="color: blue;">原始的jar</span>，打开helloworld-0.0.1-SNAPSHOT.jar的META-INF/MANIFEST. MF。可以看到它包含如下信息：

Manifest-Version: 1.0

Build-Jdk: 1.6.0_24

Built-By: hadoop

Created-By: Apache Maven 3.2.5

<span style="color: #ff0066;">Main-Class</span>: <span style="color: blue;">org.hebut.test.helloworld.HelloWorld</span>

Archiver-Version: Plexus Archiver

现在，在项目根目录中执行该jar文件：

E:\Test\helloworld>java -jar target\helloworld-0.0.1-SNAPSHOT.jar

Hello Maven

控制台输出为Hello Maven，这正是我们所期望的。

# 三、使用Archetype生成项目骨架

## 3.1 Maven 项目约定

HelloWorld项目中有一些Maven的约定：在项目的<span style="color: #ff0066;">根目录</span>中放置<span style="color: blue;">pom.xml</span>，在<span style="color: #ff0066;">src/main/java</span>目录中放置<span style="color: blue;">项目的主代码</span>，在<span style="color: #ff0066;">src/test/java</span>中放置<span style="color: blue;">项目的测试代码</span>。我们称这些<span style="color: blue;">基本的目录结构</span>和<span style="color: blue;">pom. xml文件内容</span>称为<span style="color: #ff0066;">项目的骨架</span>。Maven项目的骨架如下：

|---MavenProject

|---pom.xml

|---src

|---main              

|---java

|---test

|---java

## 3.2 Maven Archetype

当第一次创建项目骨架的时候，你还会饶有兴趣地去体会这些默认约定背后的思想，第二次，第三次，你也许还会满意自己的熟练程度，但第四、第五次做同样的事情，你可能就会恼火了。为此Maven提供了<span style="color: #ff0066;">Archetype</span>以帮助我们快速勾勒出项目骨架。还是以<span style="color: #00b0f0;">Hello World为例</span>，我们使<span style="color: blue;">用maven archetype</span>来<span style="color: #006600;">创建</span>该<span style="color: #ff0066;">项目的骨架</span>，离开当前的Maven项目目录。

如果是Maven 3简单地运行：

<span style="color: blue;">mvn archetype:generate</span>

如果是Maven 2最好运行如下命令：

<span style="color: blue;">mvn <span style="color: #ff0066;">org.apache.maven.plugins<span style="color: blue;">:<span style="color: #006600;">maven-archetype-plugin<span style="color: blue;">:<span style="color: #ffc000;">2.0-alpha-5<span style="color: blue;">:generate</span></span></span></span></span></span></span>

很多资料会让你直接使用更为简单的mvn archetype:generate命令，但在<span style="color: #ff0066;">Maven 2中</span>这是不安全的，因为该命令没有指定Archetype插件的版本，于是Maven会自动去下载最新的版本，进而可能得到不稳定的SNAPSHOT版本，导致运行失败。然而在<span style="color: #ff0066;">Maven 3中</span>，即使用户没有指定版本，Maven也只会解析最新的稳定版本，因此这是安全的。

我们实际上是在运行插件<span style="color: #ff0066;">maven-archetype-plugin</span>，注意冒号的分隔，其格式为<span style="color: blue;">groupld</span>:<span style="color: blue;">artifactid</span>:<span style="color: blue;">version</span>:<span style="color: blue;">goal</span>，<span style="color: #ff0066;">org.apache.maven.plugins</span>是maven官方插件的<span style="color: blue;">groupld</span>，<span style="color: #006600;">maven-archetype-plugin</span>是Archetype插件的<span style="color: blue;">artifactId</span>，<span style="color: #ffc000;">2.0-alpha-5</span>是日前该插件<span style="color: blue;">最新的稳定版</span>，<span style="color: blue;">generat</span>e是要<span style="color: blue;">使用的插件目标</span>。

## 3.3 Maven Archetype 生成HelloWorld

执行mvn archetype:generate后，紧接着会看到一段长长的输出，有很多可用的<span style="color: #ff0066;">Archetype供选择</span>，包括著名的<span style="color: #006600;">Appfuse项目</span>的<span style="color: blue;">Archetype</span>、<span style="color: #006600;">JPA项目</span>的<span style="color: blue;">Archetype</span>等。每一个Archetype前面都会对应有一个编号，同时命令行会提示一个<span style="color: #006600;">默认的编号</span>，其<span style="color: #006600;">对应的Archetype</span>为<span style="color: blue;">maven-archetype-quickstart</span>，直接回车以选择该Archetype：

![](https://images0.cnblogs.com/blog/671563/201503/161247453459796.png)

，紧接着Maven会提示输入要创建项目的groupId、artifactId、version以及包名package。如下输入并确认：

![](https://images0.cnblogs.com/blog/671563/201503/161247459231141.png)

Archetype插件将根据我们提供的信息创建项目骨架。在当前目录下，Archetype插件会创建一个名为<span style="color: red;">HelloWorld</span>，即我们定义的artifactId。从中可以看到项目的基本结构：

|---HelloWorld

|---pom.xml

|---src

     |---main

     |---java

         |---org.hebut.maven.helloworld

    |---test

     |---java

基本的<span style="color: #ff0066;">pom.xml</span>已经被创建，里面包含了<span style="color: blue;">必要的信息</span>以及一个<span style="color: blue;">junit依赖</span>；<span style="color: #ff0066;">主代码目录<span style="color: blue;">src/main/java</span>已经被创建，在该目录下还有一个</span>Java类<span style="color: blue;">org.hebut.maven.helloworld.App</span>，注意这里使用到了刚才定义的包名，而这个类也仅仅只有一个简单的输出"Hello World!"的main方法；<span style="color: #ff0066;">测试代码目录<span style="color: blue;">src/test/java</span>也被创建好了，并且包含了一个测试用例<span style="color: blue;">org.hebut.maven.helloworld.AppTest</span>。</span>

Archetype可以帮助我们迅速地构建起项目的骨架，在前面的例子中，我们完全可以在Archetype生成的骨架的基础上开发Hello World项目以节省大量时间。此外，这里仅仅是看到了一个最简单的Archetype，如果有很多项目拥有类似的自定义项目结构以及配置文件，则完全可以一劳永逸地开<span style="color: #ff0066;">发自己的Archetype</span>。然后在这些项目中使用自定义的Archetype来快速生成项目骨架。

# 四、m2eclipse简单使用

前面介绍HelloWorld项目的时候，并没有涉及IDE，如此简单的一个项目，使用最简单的编辑器也能很快完成。但对于稍微大一些的项目来说，没有IDE就是不可想象的。那么，下面将介绍一个目前比较常用的一款Maven IDE插件：<span style="color: blue;">m2eclipse</span>。m2eclipse是Eclipse中的一款Maven插件，功能比较强大，下面将介绍一下m2eclispe的基本使用。

## 4.1 导入Maven项目

在上期，介绍了如何安装m2eclipse。现在，使用m2ecilpse导人HelloWorld项目：

<span style="color: #0070c0;">**步骤一**</span>：选择菜单项File，然后选择Import，我们会看到一个Import对话框。在该对话框中选择Mavenl目录下的Maven Projects：

![](https://images0.cnblogs.com/blog/671563/201503/161247466106283.png)

<span style="color: #0070c0;">**步骤二**</span>：然后单击Next按钮，就会出现Import Projects对话框：

![](https://images0.cnblogs.com/blog/671563/201503/161247472351641.png)

<span style="color: #0070c0;">**步骤三**</span>：在该对话框中，单击Browse按钮选择HelloWorld的根目录，即包含pom. xml文件的那个目录

![](https://images0.cnblogs.com/blog/671563/201503/161247481262014.png)

这时对话框中的Projects：部分就会显示该目录包含的Maven项目，如上图所示。

<span style="color: #0070c0;">**步骤四**</span>：单击Finish按钮之后，m2ecilpse就会将该项目导人到当前的workspace中

![](https://images0.cnblogs.com/blog/671563/201503/161247489858441.png)

导人完成之后，就可以在Package Explorer视图中看上图所示的项目结构。

从上图，我们看到主代码目录src/main/java和测试代码目录src/test/java成了Eclipse中的资源目录，包和类的结构也十分清晰。当然pom.xml永远在项目的根目录下，而从这个视图中甚至还能看到项目的依赖junit-3.8.1.jar，其实际的位置指向了Maven本地仓库。这里自定义了Maven本地仓库地址为F:\Tools\DevelopTool\MavenSource。

## 4.2 创建Maven项目

创建一个Maven项目也十分简单，下面简单介绍一下Maven项目创建方式。

<span style="color: #0070c0;">**步骤一**</span>：选择菜单项File→New→Other，在弹出的对话框中选择Maven下的Maven Project：

![](https://images0.cnblogs.com/blog/671563/201503/161247496103799.png)

<span style="color: #0070c0;">**步骤二：**</span>然后单击Next按钮，在弹出的New Maven Project对话框中，使用默认的选项，不要选择Create a simple project选项，那样我们就能使用Maven Arche-

type

![](https://images0.cnblogs.com/blog/671563/201503/161247502049913.png)

<span style="color: #0070c0;">**步骤三：**</span>单击Next按钮，此时m2eclipse会提示我们选择一个Archetype。这里选择maven-ar-chetype-quickstart

![](https://images0.cnblogs.com/blog/671563/201503/161247511733544.png)

<span style="color: #0070c0;">**步骤四：**</span>再单击Next按钮，由于m2eclipse实际上是在使用maven-archetype-plugin插件创建项目，因此这个步骤与上一节使用archetype创建项目骨架类似，输入groupld、artifactld、version、package（暂时不考虑Properties）。如下图所示：

![](https://images0.cnblogs.com/blog/671563/201503/161247519073701.png)

单击Finish按钮，Maven项目就创建完成了了，其结构与前一个已导入的HelloWorld项目结构基本一致。

![](https://images0.cnblogs.com/blog/671563/201503/161247526883573.png)

## 4.3 运行<span style="font-size: 18pt;">mvn</span>命令

之前，我们需要在命令行输入如mvn clean install之类的命令来执行maven构建，m2eclipse中也有对应的功能。在Maven项目或者pom. xml上右击，再在弹出的快捷菜单中选择Run As，就能看到常见的Maven命令，如下图所示：

![](https://images0.cnblogs.com/blog/671563/201503/161247536571502.png)

选择想要执行的Maven命令就能执行相应的构建，同时也能在Eclipse的console中看到构建输出。这里常见的一个问题是，默认选项中<span style="color: #ff0066;">没有我们想要执行的Maven命令</span>怎么办？比如，默认带有mvn test，但我们想执行mvn clean test。很简单，选择<span style="color: blue;">Maven build</span>以<span style="color: #006600;">自定义Maven运行命令</span>，在弹出话框的Goals一项中输入我们想要执行的命令，如clean test，设置一下Name，单击Run即可。并且，下一次我们选择Maven build或者使用快捷键"Alt+Shift+X，M"快速执行Maven构建的时候，上次的配置直接就能在历史记录中找到。

![](https://images0.cnblogs.com/blog/671563/201503/161247542679088.png)
